<div id="livechat" class="closed">
	<div class="title">
		<?php echo __('Contact Us'); ?>
	</div>
	<div id="discussion">
		<div id="livedisc"></div>
	</div>
	<form id="livechatform" action="<?php echo $this->getFormAction(); ?>" type="post">
		<textarea id="message" name="message" placeholder="<?php echo __('Type and press [enter]'); ?>"></textarea> 
	</form>
</div>
<script type="text/javascript">
	require(['jquery'], function($){ 
     	$('#livechat .title').click(function(){
     		if($('#livechat').hasClass('closed')){
     			$('#livechat').removeClass('closed');
     		}else{
     			$('#livechat').addClass('closed');
     		}
     	})
     	$('#message').keypress(function (e) {
		  	if (e.which == 13) {
		    	$('#livechatform').submit();
		    	return false;
		  	}
		});
     	$("#livechatform").submit(function(e) {
		    var url = "<?php echo $this->getFormAction(); ?>";
		    $.ajax({
	           	type: "POST",
	           	url: url,
	           	data: $("#livechatform").serialize(),
	           	success: function(data){
	           		var message = $('#message').val();
	           		$('#livedisc').append('<div class="message customer">'+message+'</div>');
	           		$('#message').val('');
	           		$('#livedisc').animate({bottom: 0});
	           		changeProportions();
	           		console.log('Success!');
	               	console.log(data);
	           	},
	            error: function (data) {
	                console.log('An error occurred.');
	                console.log(data);
	            }
		    });
		    e.preventDefault();
		});
		function changeProportions(){
			var liveDiscussionHeight = $('#livedisc').height();
			console.log('liveDiscussionHeight='+liveDiscussionHeight);
			var proportion = liveDiscussionHeight / 230;
			console.log('proportion='+proportion);
			if (proportion < 1){
				console.log('proportion < 1');
			}else{
				console.log('proportion >= 1');
				if($('#discussion').find('.scrollBar').length !== 0){
					console.log('#discussion has .scrollBar');
				}else{
					console.log('#discussion doesn\'t have .scrollBar');
					$('#discussion').prepend('<div class="scrollBar"><div class="slider"></div></div>');
				}
			}
		}
 	});
</script>